<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Third-Party Script Optimizer - Demo</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      border-radius: 10px;
      margin-bottom: 30px;
    }
    .section {
      background: #f8f9fa;
      padding: 30px;
      margin-bottom: 20px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .widget-placeholder {
      background: white;
      border: 2px dashed #ccc;
      padding: 40px;
      text-align: center;
      margin: 20px 0;
      border-radius: 5px;
    }
    code {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.9em;
    }
    pre {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
    .performance-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #667eea;
    }
    .stat-label {
      color: #666;
      font-size: 0.9em;
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>üöÄ Third-Party Script Optimizer</h1>
    <p>Reduce main thread blocking from ~1700ms to ~300ms (75-82% improvement)</p>
  </div>

  <div class="section">
    <h2>üìä Performance Impact</h2>
    <div class="performance-stats">
      <div class="stat-card">
        <div class="stat-value">-82%</div>
        <div class="stat-label">Main Thread Blocking</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">-91%</div>
        <div class="stat-label">Widget Loading Time</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">-25%</div>
        <div class="stat-label">LCP Improvement</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">3x</div>
        <div class="stat-label">Faster Page Load</div>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>üéØ How It Works</h2>
    <p>This optimizer uses three intelligent loading strategies:</p>
    <ul>
      <li><strong>Visibility-based:</strong> Scripts load only when elements become visible</li>
      <li><strong>Interaction-based:</strong> Scripts load on first user interaction (scroll, click, etc.)</li>
      <li><strong>Idle-based:</strong> Non-critical scripts load during browser idle time</li>
    </ul>
  </div>

  <div class="section">
    <h2>üß™ Demo: Widget Placeholders</h2>
    <p>Scroll down to see widgets load automatically when they become visible!</p>

    <div class="widget-placeholder" data-reviews-io>
      <h3>Reviews Widget</h3>
      <p>This widget will load when it becomes visible in the viewport</p>
      <p><small>(IntersectionObserver + 200px margin)</small></p>
    </div>

    <div class="widget-placeholder" data-tolstoy>
      <h3>Video Widget</h3>
      <p>Video player loads only when scrolled into view</p>
      <p><small>(Saves ~150ms initial blocking)</small></p>
    </div>

    <div class="widget-placeholder" data-yotpo-instance-id="demo">
      <h3>Loyalty Widget</h3>
      <p>Loads on hover, touch, or click</p>
      <p><small>(184ms ‚Üí ~20ms = 89% reduction)</small></p>
    </div>
  </div>

  <div class="section">
    <h2>‚öôÔ∏è Configuration Example</h2>
    <pre><code>&lt;!-- 1. Load core library first --&gt;
&lt;script src="defer-third-party.js" async&gt;&lt;/script&gt;

&lt;!-- 2. Configure analytics --&gt;
&lt;script&gt;
  window.ANALYTICS_CONFIG = {
    gtm: {
      enabled: true,
      id: 'GTM-XXXXXX'
    },
    facebook: {
      enabled: true,
      pixelId: 'YOUR_PIXEL_ID'
    },
    linkedin: {
      enabled: true,
      partnerId: 'YOUR_PARTNER_ID'
    }
  };
&lt;/script&gt;
&lt;script src="optimized-analytics.js" defer&gt;&lt;/script&gt;

&lt;!-- 3. Configure widgets --&gt;
&lt;script&gt;
  window.WIDGET_CONFIG = {
    reviewsIO: {
      enabled: true
    },
    yotpo: {
      enabled: true,
      appKey: 'YOUR_APP_KEY'
    },
    tolstoy: {
      enabled: true
    }
  };
&lt;/script&gt;
&lt;script src="third-party-optimizer.js" defer&gt;&lt;/script&gt;</code></pre>
  </div>

  <div class="section">
    <h2>üìà Before vs. After</h2>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: #667eea; color: white;">
          <th style="padding: 10px; text-align: left;">Component</th>
          <th style="padding: 10px;">Before</th>
          <th style="padding: 10px;">After</th>
          <th style="padding: 10px;">Improvement</th>
        </tr>
      </thead>
      <tbody>
        <tr style="background: white;">
          <td style="padding: 10px;">Main Thread Blocking</td>
          <td style="padding: 10px; text-align: center;">1700ms</td>
          <td style="padding: 10px; text-align: center;">300ms</td>
          <td style="padding: 10px; text-align: center; color: green; font-weight: bold;">-82%</td>
        </tr>
        <tr style="background: #f8f9fa;">
          <td style="padding: 10px;">Recharge Widget</td>
          <td style="padding: 10px; text-align: center;">566ms</td>
          <td style="padding: 10px; text-align: center;">50ms</td>
          <td style="padding: 10px; text-align: center; color: green; font-weight: bold;">-91%</td>
        </tr>
        <tr style="background: white;">
          <td style="padding: 10px;">Yotpo Widget</td>
          <td style="padding: 10px; text-align: center;">184ms</td>
          <td style="padding: 10px; text-align: center;">20ms</td>
          <td style="padding: 10px; text-align: center; color: green; font-weight: bold;">-89%</td>
        </tr>
        <tr style="background: #f8f9fa;">
          <td style="padding: 10px;">GTM</td>
          <td style="padding: 10px; text-align: center;">200ms</td>
          <td style="padding: 10px; text-align: center;">30ms</td>
          <td style="padding: 10px; text-align: center; color: green; font-weight: bold;">-85%</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="section">
    <h2>üîß Check Console</h2>
    <p>Open your browser console to see loading events and timing information.</p>
    <button onclick="if(window.OptimizedAnalytics){window.OptimizedAnalytics.load();alert('Analytics loaded!');}">
      Manually Trigger Analytics Load
    </button>
  </div>

  <!-- ============================================ -->
  <!-- ACTUAL IMPLEMENTATION (configured for demo) -->
  <!-- ============================================ -->

  <!-- 1. Core Library -->
  <script src="../core/defer-third-party.js" async></script>

  <!-- 2. Analytics Configuration -->
  <script>
    // Demo configuration (disabled by default)
    window.ANALYTICS_CONFIG = {
      gtm: {
        enabled: false, // Set to true and add your GTM ID
        id: ''
      },
      facebook: {
        enabled: false,
        pixelId: ''
      },
      bing: {
        enabled: false,
        tagId: ''
      },
      linkedin: {
        enabled: false,
        partnerId: ''
      }
    };
  </script>
  <script src="optimized-analytics.js" defer></script>

  <!-- 3. Widget Configuration -->
  <script>
    // Demo configuration
    window.WIDGET_CONFIG = {
      reviewsIO: {
        enabled: true // Will show console logs but not load actual scripts
      },
      yotpo: {
        enabled: false, // Set to true and add your app key
        appKey: ''
      },
      tolstoy: {
        enabled: true // Will show console logs
      },
      // Custom widget example
      custom: [
        {
          enabled: false,
          name: 'Custom Chat Widget',
          selectors: ['.chat-widget'],
          scriptUrl: 'https://example.com/chat.js',
          loadStrategy: 'interaction' // 'visibility', 'interaction', or 'idle'
        }
      ]
    };
  </script>
  <script src="third-party-optimizer.js" defer></script>

  <!-- Demo Console Logging -->
  <script>
    console.log('%cüöÄ Third-Party Script Optimizer Demo', 'font-size: 20px; color: #667eea; font-weight: bold;');
    console.log('%cWatch this console for loading events...', 'color: #666;');

    // Log when DeferLib is ready
    window.addEventListener('load', function() {
      setTimeout(function() {
        if (window.DeferLib) {
          console.log('%c‚úÖ DeferLib loaded and ready', 'color: green;');
        }
        if (window.OptimizedAnalytics) {
          console.log('%c‚úÖ Optimized Analytics initialized', 'color: green;');
        }
        if (window.WidgetOptimizer) {
          console.log('%c‚úÖ Widget Optimizer initialized', 'color: green;');
        }
      }, 1000);
    });
  </script>

</body>
</html>
